{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-form-persistence",
  "description": "Hook to persist form values to localStorage or sessionStorage",
  "dependencies": [
    "react-hook-form"
  ],
  "files": [
    {
      "path": "src/registry/default/hooks/use-form-persistence.ts",
      "content": "\"use client\";\n\nimport { useEffect, useCallback } from \"react\";\nimport type { UseFormReturn, FieldValues } from \"react-hook-form\";\n\nexport interface UseFormPersistenceOptions<TFieldValues extends FieldValues> {\n  /**\n   * Unique key for localStorage/sessionStorage\n   */\n  key: string;\n\n  /**\n   * Storage type to use\n   * @default \"localStorage\"\n   */\n  storage?: \"localStorage\" | \"sessionStorage\";\n\n  /**\n   * Auto-save on form value changes\n   * @default true\n   */\n  autoSave?: boolean;\n\n  /**\n   * Debounce delay in milliseconds for auto-save\n   * @default 1000\n   */\n  debounceMs?: number;\n\n  /**\n   * Fields to exclude from persistence\n   */\n  exclude?: (keyof TFieldValues)[];\n\n  /**\n   * Callback when form is restored from storage\n   */\n  onRestore?: (values: Partial<TFieldValues>) => void;\n\n  /**\n   * Callback when form is saved to storage\n   */\n  onSave?: (values: TFieldValues) => void;\n}\n\n/**\n * Hook to persist form values to localStorage or sessionStorage\n * \n * @example\n * ```tsx\n * const form = useForm();\n * const { clearStorage } = useFormPersistence(form, {\n *   key: \"signup-form\",\n *   autoSave: true,\n *   exclude: [\"password\"]\n * });\n * ```\n */\nexport function useFormPersistence<TFieldValues extends FieldValues>(\n  form: UseFormReturn<TFieldValues>,\n  options: UseFormPersistenceOptions<TFieldValues>\n) {\n  const {\n    key,\n    storage = \"localStorage\",\n    autoSave = true,\n    debounceMs = 1000,\n    exclude = [],\n    onRestore,\n    onSave,\n  } = options;\n\n  const storageApi = typeof window !== \"undefined\" \n    ? storage === \"localStorage\" \n      ? window.localStorage \n      : window.sessionStorage\n    : null;\n\n  /**\n   * Save current form values to storage\n   */\n  const saveToStorage = useCallback(() => {\n    if (!storageApi) return;\n\n    const values = form.getValues();\n    const filtered = { ...values };\n\n    // Exclude specified fields\n    exclude.forEach((field) => {\n      delete filtered[field as string];\n    });\n\n    try {\n      storageApi.setItem(key, JSON.stringify(filtered));\n      onSave?.(values);\n    } catch (error) {\n      console.error(\"Failed to save form to storage:\", error);\n    }\n  }, [form, key, exclude, storageApi, onSave]);\n\n  /**\n   * Restore form values from storage\n   */\n  const restoreFromStorage = useCallback(() => {\n    if (!storageApi) return;\n\n    try {\n      const stored = storageApi.getItem(key);\n      if (stored) {\n        const values = JSON.parse(stored) as Partial<TFieldValues>;\n        \n        // Reset form with stored values\n        Object.entries(values).forEach(([fieldName, value]) => {\n          form.setValue(fieldName as any, value, { shouldDirty: true });\n        });\n\n        onRestore?.(values);\n      }\n    } catch (error) {\n      console.error(\"Failed to restore form from storage:\", error);\n    }\n  }, [key, storageApi, form, onRestore]);\n\n  /**\n   * Clear form data from storage\n   */\n  const clearStorage = useCallback(() => {\n    if (!storageApi) return;\n    \n    try {\n      storageApi.removeItem(key);\n    } catch (error) {\n      console.error(\"Failed to clear form storage:\", error);\n    }\n  }, [key, storageApi]);\n\n  // Restore on mount\n  useEffect(() => {\n    restoreFromStorage();\n  }, [restoreFromStorage]);\n\n  // Auto-save on value changes\n  useEffect(() => {\n    if (!autoSave) return;\n\n    const subscription = form.watch(() => {\n      const timeoutId = setTimeout(() => {\n        saveToStorage();\n      }, debounceMs);\n\n      return () => clearTimeout(timeoutId);\n    });\n\n    return () => subscription.unsubscribe();\n  }, [form, autoSave, debounceMs, saveToStorage]);\n\n  return {\n    saveToStorage,\n    restoreFromStorage,\n    clearStorage,\n  };\n}\n",
      "type": "registry:hook"
    }
  ],
  "type": "registry:hook"
}